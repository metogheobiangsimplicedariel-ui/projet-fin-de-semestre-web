<?php
class EtudiantModel {
    private $db;
    
    public function __construct() {
        require_once __DIR__ . '/../config/database.php';
        $this->db = Database::getConnection();
    }
    
    public function getEtudiantsByMatiere($matiereId) {
        $sql = "SELECT u.id, u.nom, u.prenom, u.email, u.numero_etudiant
                FROM utilisateurs u
                INNER JOIN inscriptions i ON u.id = i.etudiant_id
                WHERE i.matiere_id = ?
                AND u.type = 'etudiant'
                AND u.actif = 1
                ORDER BY u.nom ASC, u.prenom ASC";
        
        try {
            $stmt = $this->db->prepare($sql);
            $stmt->execute([$matiereId]);
            return $stmt->fetchAll(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            error_log("Erreur getEtudiantsByMatiere: " . $e->getMessage());
            return [];
        }
    }
    
    public function getEtudiantById($etudiantId) {
        $sql = "SELECT * FROM utilisateurs 
                WHERE id = ? AND type = 'etudiant' AND actif = 1";
        
        try {
            $stmt = $this->db->prepare($sql);
            $stmt->execute([$etudiantId]);
            return $stmt->fetch(PDO::FETCH_ASSOC);
        } catch (PDOException $e) {
            error_log("Erreur getEtudiantById: " . $e->getMessage());
            return null;
        }
    }
}
?>